#!/usr/bin/env bash

# Cause the script to exit if a single command fails
set -eo pipefail -v

CPU_REQUIRED=1 MASTER_ADDR="127.0.0.1" MASTER_PORT=2112 CATALYST_COMPUTE_PER_CLASS_METRICS="1" OMP_NUM_THREADS="1" MKL_NUM_THREADS="1" pytest ./tests/pipelines

GPU_REQUIRED=1 MASTER_ADDR="127.0.0.1" MASTER_PORT=2112 CATALYST_COMPUTE_PER_CLASS_METRICS="1" OMP_NUM_THREADS="1" MKL_NUM_THREADS="1" pytest ./tests/pipelines
GPU_AMP_REQUIRED=1 MASTER_ADDR="127.0.0.1" MASTER_PORT=2112 CATALYST_COMPUTE_PER_CLASS_METRICS="1" OMP_NUM_THREADS="1" MKL_NUM_THREADS="1" pytest ./tests/pipelines

DP_REQUIRED=1 MASTER_ADDR="127.0.0.1" MASTER_PORT=2112 CATALYST_COMPUTE_PER_CLASS_METRICS="1" OMP_NUM_THREADS="1" MKL_NUM_THREADS="1" pytest ./tests/pipelines
DP_AMP_REQUIRED=1 MASTER_ADDR="127.0.0.1" MASTER_PORT=2112 CATALYST_COMPUTE_PER_CLASS_METRICS="1" OMP_NUM_THREADS="1" MKL_NUM_THREADS="1" pytest ./tests/pipelines

DDP_REQUIRED=1 MASTER_ADDR="127.0.0.1" MASTER_PORT=2112 CATALYST_COMPUTE_PER_CLASS_METRICS="1" OMP_NUM_THREADS="1" MKL_NUM_THREADS="1" pytest ./tests/pipelines
DDP_AMP_REQUIRED=1 MASTER_ADDR="127.0.0.1" MASTER_PORT=2112 CATALYST_COMPUTE_PER_CLASS_METRICS="1" OMP_NUM_THREADS="1" MKL_NUM_THREADS="1" pytest ./tests/pipelines
