
# Before start

0. Please install `mean-average-precision` and `xmltodict` python packages. 

    To install required packages using following command:

    ```bash
    pip install -r catalyst/examples/detection/requirements.txt
    ```

1. Create or convert existing one training and validation datasets to [COCO format](https://cocodataset.org/#format-data) - you need to have `.json` files with annotations.

In this example will be used dataset from [Kaggle - Fruit Detection](https://www.kaggle.com/andrewmvd/fruit-detection).

To convert it to COCO you need to use `to_coco.py` script. This script requires additional package - [`xmltodict`](https://pypi.org/project/xmltodict/).


Usage is simple:

```bash
python3 to_coco.py <images directory> <annotations directory> <output json file>
```


## Single Shot Detector (SSD)

SSD expects that dataset will return bounding box tensor with shapes `[num anchors, 4]` and labels tensor with shapes `[num anchors]`, where `num anchors` is a fixed number of predictions generated by a model.

Each bounding box should be in a format `[x_center, y_center, width, height]`. Usually, there are fewer objects on an image than `num anchors` returned by a model, to handle this your model should have an additional class for `background` and bounding boxes to ignore (or empty bounding boxes) should be marked with that class.


```bash
catalyst-dl run \
    --config catalyst/examples/detection/configs/ssd-config.yaml \
    --expdir catalyst/examples/detection \
    --logdir ssd-detection-logs \
    --verbose
```


## CenterNet

CenterNet returns two tensors - class heatmap (tensor with shape `[num classes, heatmap height, heatmap width]`) and Width-Height regression (tensor with shape `[2, heatmap height, heatmap width]`). The last one represents bounding box width and height. To get object centers (`x_center` and `y_center`) you can apply MaxPool with `3x3` kernel size and stride - `1` and padding - `1` to class heatmap.

```bash
catalyst-dl run \
    --config catalyst/examples/detection/configs/centernet-config.yaml \
    --expdir catalyst/examples/detection \
    --logdir centernet-detection-logs \
    --verbose
```


## YOLO-X

YOLO-X predicts tensor with shape `[num anchors, 4 + 1 + num classes]`. This tensor consists of bounding box coordinates, class confidence, and class probability.
To extract bounding boxes need to get first 4 numbers for each anchor, confidences can be extracted by 4th index. The numbers after 4th index represent class probabilities.

**NOTE:** YOLO-X predicts bounding boxes in format `(x_center, y_center, w, h)`.

```bash
catalyst-dl run \
    --config catalyst/examples/detection/configs/yolo-x-config.yaml \
    --expdir catalyst/examples/detection \
    --logdir centernet-detection-logs \
    --verbose
```
